name: Windows Tests

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  workflow_dispatch:

jobs:
  test-windows:
    runs-on: windows-latest
    timeout-minutes: 5
    env:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      OPENAI_MODEL_NAME: gpt-4o-mini
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: "3.11"
    
    - name: Install praisonaiagents
      run: |
        python -m pip install --upgrade pip
        cd src/praisonai-agents
        pip install .
      shell: bash
    
    - name: Install praisonai wrapper
      run: |
        cd src/praisonai
        pip install .[dev]
      shell: bash

    - name: Test core imports
      run: |
        python -c "from praisonaiagents import Agent, Agents, Workflow; print('Core imports OK')"
        python -c "from praisonaiagents import tool, Tools; print('Tool imports OK')"
        python -c "from praisonaiagents import Task, WorkflowStep; print('Task/Step imports OK')"

    - name: Test Agent instantiation
      run: python -c "from praisonaiagents import Agent; a = Agent(name='Test', instructions='You are helpful'); print('Agent created:', a.name)"

    - name: Test Agents orchestration
      run: python -c "from praisonaiagents import Agent, Agents; a = Agent(name='Test', instructions='Hi'); agents = Agents(agents=[a]); print('Agents created:', len(agents.agents))"

    - name: Test Workflow creation
      run: python -c "from praisonaiagents import Workflow, WorkflowStep; w = Workflow(name='test'); s = WorkflowStep(name='step1'); print('Workflow:', w.name, 'Step:', s.name)"

    - name: Test CLI help
      run: praisonai --help

    - name: Test CLI session list
      run: praisonai session ls
      continue-on-error: true

    - name: Test CLI queue list
      run: praisonai queue ls
      continue-on-error: true

    - name: Real API test - Agent run
      if: env.OPENAI_API_KEY != ''
      run: |
        python -c "
        from praisonaiagents import Agent
        agent = Agent(name='TestAgent', instructions='Reply with exactly: WINDOWS_OK', llm='gpt-4o-mini')
        result = agent.run('Say WINDOWS_OK')
        print('Result:', result)
        print('Real API test passed')
        "
